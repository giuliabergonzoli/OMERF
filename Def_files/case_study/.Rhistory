knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/magistrale/tesi/Master_Thesis/Def_files/dati")
source("OMERF_new.R")
source("ord_class_index.R")
source('index.R')
studenti <- read.csv("student_ita.csv", sep = ",", dec = ".") #10552
studenti <- studenti[,-1]
studenti$mate9[which(studenti$mate9=="6")]="8"
studenti$mate9[which(studenti$mate9=="5")]="7"
studenti$mate9[which(studenti$mate9=="4")]="6"
studenti$mate9[which(studenti$mate9=="3")]="5"
studenti$mate9[which(studenti$mate9=="2")]="4"
studenti$mate9[which(studenti$mate9=="1c")]="3"
studenti$mate9[which(studenti$mate9=="1b")]="2"
studenti$mate9[which(studenti$mate9=="1a")]="1"
studenti$mate3[which(studenti$mate3=="high")]="3"
studenti$mate3[which(studenti$mate3=="medium")]="2"
studenti$mate3[which(studenti$mate3=="low")]="1"
na=rep(0,39)
for (i in 1:39) {
na[i]=sum(is.na(studenti[,i]))
}
na
studenti <- na.omit(studenti) #7833
#keep schools with at least 10 students
school_counts=table(studenti$school_ID) #340 schools
selected_sch <- names(school_counts[school_counts >= 10]) #293 schools
studenti_new <- studenti[studenti$school_ID %in% selected_sch, ]
studenti_new$grade <- as.factor(studenti_new$grade)
table(studenti_new$grade)
studenti_new$gender <- as.factor(studenti_new$gender)
studenti_new$immig <- as.factor(studenti_new$immig)
#random effects
studenti_new$school_ID <- as.factor(studenti_new$school_ID)
#responses
studenti_new$mate9=as.factor(studenti_new$mate9)
studenti_new$mate3=as.factor(studenti_new$mate3)
set.seed(1999)
library(caret)
library(caret)
split_indices <- createDataPartition(studenti_new$mate9, p = 0.80, list = FALSE)
data_test_orig <- studenti_new[-split_indices, ]
data_test <- data_test_orig[,c("grade", "gender", "immig", "video_games", "internet_quality", "internet_availability", "SCHRISK", "BULLIED", "BELONG", "COOPAGR", "TEACHSUP", "FAMSUP", "PERSEVAGR", "ASSERAGR", "EMPATAGR", "EMOCOAGR", "STRESAGR", "CURIOAGR", "study_time", "HISCED", "ESCS")] #"MISCED", "FISCED", "math_time"
studenti_new <- studenti_new[split_indices, ]
y_test_orig=data_test_orig$mate9 #mate3
y=studenti_new$mate9
y_test_orig=data_test_orig$mate9 #mate3
y=studenti_new$mate9
cov=studenti_new[,c("grade", "gender", "immig", "video_games", "internet_quality", "internet_availability", "SCHRISK", "BULLIED", "BELONG", "COOPAGR", "TEACHSUP", "FAMSUP", "PERSEVAGR", "ASSERAGR", "EMPATAGR", "EMOCOAGR", "STRESAGR", "CURIOAGR", "study_time", "MISCED", "ESCS")]
group=studenti_new$school_ID
forest.data=cbind(clm.data,group)
clm.data= cbind(y,cov)
library(ordinal)
forest.data=cbind(clm.data,group)
clmm.data=forest.data
clmm.0=clmm(y ~ grade+gender+immig+video_games+internet_quality+internet_availability+SCHRISK+BULLIED+BELONG+COOPAGR+TEACHSUP+FAMSUP+PERSEVAGR+ASSERAGR+EMPATAGR+EMOCOAGR+STRESAGR+CURIOAGR+study_time+MISCED+FISCED+HISCED+(1|group), link='logit', data=clmm.data, Hess=TRUE, control=clmm.control(maxLineIter = 200, maxIter=500, grtol=1e-4))
clmm.0=clmm(y ~ grade+gender+immig+video_games+internet_quality+internet_availability+SCHRISK+BULLIED+BELONG+COOPAGR+TEACHSUP+FAMSUP+PERSEVAGR+ASSERAGR+EMPATAGR+EMOCOAGR+STRESAGR+CURIOAGR+study_time+HISCED+(1|group), link='logit', data=clmm.data, Hess=TRUE, control=clmm.control(maxLineIter = 200, maxIter=500, grtol=1e-4))
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "D:/magistrale/tesi/Master_Thesis/Def_files/dati")
source("OMERF_new.R")
source("ord_class_index.R")
source('index.R')
studenti <- read.csv("student_ita.csv", sep = ",", dec = ".") #10552
studenti <- studenti[,-1]
studenti$mate9[which(studenti$mate9=="6")]="8"
studenti$mate9[which(studenti$mate9=="5")]="7"
studenti$mate9[which(studenti$mate9=="4")]="6"
studenti$mate9[which(studenti$mate9=="3")]="5"
studenti$mate9[which(studenti$mate9=="2")]="4"
studenti$mate9[which(studenti$mate9=="1c")]="3"
studenti$mate9[which(studenti$mate9=="1b")]="2"
studenti$mate9[which(studenti$mate9=="1a")]="1"
studenti$mate3[which(studenti$mate3=="high")]="3"
studenti$mate3[which(studenti$mate3=="medium")]="2"
studenti$mate3[which(studenti$mate3=="low")]="1"
na=rep(0,39)
for (i in 1:39) {
na[i]=sum(is.na(studenti[,i]))
}
na
studenti <- na.omit(studenti) #7833
#keep schools with at least 10 students
school_counts=table(studenti$school_ID) #340 schools
selected_sch <- names(school_counts[school_counts >= 10]) #293 schools
studenti_new <- studenti[studenti$school_ID %in% selected_sch, ]
studenti_new$grade <- as.factor(studenti_new$grade)
studenti_new$gender <- as.factor(studenti_new$gender)
studenti_new$immig <- as.factor(studenti_new$immig)
#random effects
studenti_new$school_ID <- as.factor(studenti_new$school_ID)
#responses
studenti_new$mate9=as.factor(studenti_new$mate9)
studenti_new$mate3=as.factor(studenti_new$mate3)
set.seed(1999)
library(caret)
split_indices <- createDataPartition(studenti_new$mate9, p = 0.80, list = FALSE)
data_test_orig <- studenti_new[-split_indices, ]
# "school_ID", "stud_ID", "grade", "gender", "immig", "video_games", "internet_quality", "internet_availability", "SCHRISK",
# "BULLIED", "BELONG", "COOPAGR", "TEACHSUP", "FAMSUP", "PERSEVAGR", "ASSERAGR", "EMPATAGR", "EMOCOAGR", "STRESAGR",
# "CURIOAGR", "math_time", "study_time", "MISCED", "FISCED", "HISCED", "ESCS", "PV1MATH", "PV2MATH", "PV3MATH",
# "PV4MATH", "PV5MATH", "PV6MATH", "PV7MATH", "PV8MATH", "PV9MATH", "PV10MATH", "mate", "mate9", "mate3"
data_test <- data_test_orig[,c("grade", "gender", "immig", "video_games", "internet_quality", "internet_availability", "SCHRISK", "BULLIED", "BELONG", "COOPAGR", "TEACHSUP", "FAMSUP", "PERSEVAGR", "ASSERAGR", "EMPATAGR", "EMOCOAGR", "STRESAGR", "CURIOAGR", "study_time", "HISCED", "ESCS")] #"MISCED", "FISCED", "math_time"
studenti_new <- studenti_new[split_indices, ]
y_test_orig=data_test_orig$mate9 #mate3
y=studenti_new$mate9
cov=studenti_new[,c("grade", "gender", "immig", "video_games", "internet_quality", "internet_availability", "SCHRISK", "BULLIED", "BELONG", "COOPAGR", "TEACHSUP", "FAMSUP", "PERSEVAGR", "ASSERAGR", "EMPATAGR", "EMOCOAGR", "STRESAGR", "CURIOAGR", "study_time", "HISCED", "ESCS")]
group=studenti_new$school_ID
library(ordinal)
clm.data= cbind(y,cov)
forest.data=cbind(clm.data,group)
clmm.data=forest.data
clmm.0=clmm(y ~ grade+gender+immig+video_games+internet_quality+internet_availability+SCHRISK+BULLIED+BELONG+COOPAGR+TEACHSUP+FAMSUP+PERSEVAGR+ASSERAGR+EMPATAGR+EMOCOAGR+STRESAGR+CURIOAGR+study_time+HISCED+(1|group), link='logit', data=clmm.data, Hess=TRUE, control=clmm.control(maxLineIter = 200, maxIter=500, grtol=1e-4))
summary(clmm.0)
